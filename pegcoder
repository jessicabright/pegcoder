#!/usr/bin/python
import libpegcoder, os
#read ENV from conf later, but with sane defaults?
achpath = os.getenv('PACHPATH', '/usr/lib/pegcoder/archive')
workspace = os.getenv('PWRKSPACE', '/usr/lib/pegcoder/scratch')
svarpath = os.getenv('PSVARPATH', '/var/lib/pegcoder/')
susrpath = os.getenv('PSUSRPATH', '/usr/lib/pegcoder/')
fileext = os.getenv('PFILEEXT', '*.mp4')
jfilext = os.getenv('PJFILEXT', '*.json')
encodecmd = os.getenv('PENCODECMD', 'ffmpeg')
#Going to wrap up my env into setting dict so I can pass to functions easily as needed
settings = {'achpath': achpath, 'svarpath': svarpath, 'susrpath': susrpath, 'fileext': fileext, 'jfilext': jfilext, 'encodecmd': encodecmd, 'workspace': workspace}
#null list setup for first function runs
jsonstatls = []
curfilels = []
#
orgls = ['cctv']

#getstatus returns jsonstatls - list of current status of each file in json
libpegcoder.getstatus(settings, jsonstatls)
#getcurfiles returns curfilels - list of each file currently in archive
libpegcoder.getcurfiles(settings, curfilels)
#updtjsls updates json status store, should call getstatus agin after...
libpegcoder.updtjsls(settings, jsonstatls, curfilels)
#Update jsonstatls
libpegcoder.getstatus(settings, jsonstatls)

#start encoder based on org...
for org in orgls:
	libpegcoder.chkupencode(settings, jsonstatls, org)
